<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nail Art Budget Calculator | ç¾ç”²é€ å‹è©¦ç®—</title>
    <style>
        :root {
            --bg-color: #FDFBF7;
            --primary-cream: #F5E6D3;
            --accent-rose: #E8B4B8;
            --text-main: #5D534A;
            --text-light: #A89F94;
            --white: #FFFFFF;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --radius: 18px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 120px; /* ç‚ºåº•éƒ¨æ‡¸æµ®æ¬„ç•™ç©ºé–“ */
            line-height: 1.6;
        }

        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        h1 { text-align: center; font-weight: 400; font-size: 1.5rem; margin-bottom: 25px; color: var(--text-main); }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 18px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        .card-title { font-weight: 600; font-size: 1rem; margin-bottom: 15px; display: flex; align-items: center; }
        .card-title::before { content: ''; width: 4px; height: 16px; background: var(--accent-rose); margin-right: 8px; border-radius: 2px; }

        /* è¼¸å…¥æ¡†é€šç”¨æ¨£å¼ */
        input[type="number"], input[type="text"] {
            width: 100%;
            border: 1.5px solid var(--primary-cream);
            border-radius: 10px;
            padding: 10px;
            font-size: 1rem;
            color: var(--text-main);
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--accent-rose); }

        /* å¿«é¸åˆ— (Quick Toolbar) */
        .toolbar-wrapper {
            margin: 0 -20px 15px -20px;
            overflow-x: auto;
            padding: 5px 20px;
            display: flex;
            gap: 10px;
            scrollbar-width: none; /* Firefox */
        }
        .toolbar-wrapper::-webkit-scrollbar { display: none; } /* Chrome/Safari */
        
        .capsule-btn {
            white-space: nowrap;
            background: var(--primary-cream);
            border: none;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-main);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .capsule-btn:active { transform: scale(0.95); background: var(--accent-rose); color: white; }

        /* å‹•æ…‹åˆ—è¡¨ */
        .dynamic-item {
            display: grid;
            grid-template-columns: 2fr 1.2fr 1fr 40px;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* æ•¸é‡åŠ æ¸›å™¨ */
        .stepper {
            display: flex;
            align-items: center;
            background: var(--bg-color);
            border-radius: 8px;
            justify-content: space-between;
        }
        .stepper button {
            background: none; border: none; width: 30px; height: 35px; cursor: pointer; font-size: 1.2rem; color: var(--text-main);
        }
        .stepper span { font-size: 0.9rem; min-width: 20px; text-align: center; }

        .btn-delete { color: #E57373; border: none; background: none; font-size: 1.2rem; cursor: pointer; }

        /* å¸ç”²åˆ‡æ›æŒ‰éˆ• */
        .segmented-control {
            display: flex;
            background: var(--bg-color);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }
        .segment {
            flex: 1;
            text-align: center;
            padding: 8px;
            font-size: 0.85rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .segment.active { background: var(--white); box-shadow: 0 2px 8px rgba(0,0,0,0.05); color: var(--accent-rose); font-weight: bold; }

        /* åº•éƒ¨æ‡¸æµ®æ¬„ */
        .sticky-footer {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--white);
            padding: 15px 25px 35px 25px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .total-label { font-size: 0.9rem; color: var(--text-light); }
        .total-amount { font-size: 1.6rem; font-weight: bold; color: var(--accent-rose); }
        .footer-btns { display: flex; gap: 10px; }
        .btn-main {
            background: var(--text-main);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Bottom Sheet Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            display: none; z-index: 200;
        }
        .bottom-sheet {
            position: fixed; bottom: -100%; left: 0; right: 0;
            background: var(--white);
            border-radius: 25px 25px 0 0;
            padding: 25px;
            transition: bottom 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 201;
        }
        .bottom-sheet.active { bottom: 0; }
        .bill-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }
        .bill-total { border-top: 1px dashed var(--primary-cream); margin-top: 15px; padding-top: 15px; font-weight: bold; font-size: 1.1rem; text-align: right; }
        .copy-btn { width: 100%; background: var(--accent-rose); color: white; border: none; padding: 12px; border-radius: 12px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Nail Studio è©¦ç®—</h1>

        <div class="card">
            <div class="card-title">åŸºç¤åº•åƒ¹</div>
            <input type="number" id="basePrice" placeholder="è«‹è¼¸å…¥é‡‘é¡" value="1000" onchange="calcTotal()" onclick="autoFocus(this)">
        </div>

        <div class="card">
            <div class="card-title">é€²éšé€ å‹</div>
            <div class="toolbar-wrapper">
                <button class="capsule-btn" onclick="addDesign('æ‰‹ç¹ªé€ å‹', 100)">ğŸ¨ æ‰‹ç¹ª</button>
                <button class="capsule-btn" onclick="addDesign('æ³•å¼', 150)">ğŸ¤ æ³•å¼</button>
                <button class="capsule-btn" onclick="addDesign('æ»¿é‘½/å¤§é‘½', 200)">ğŸ’ æ»¿é‘½</button>
                <button class="capsule-btn" onclick="addDesign('æšˆæŸ“', 100)">ğŸŒ«ï¸ æšˆæŸ“</button>
                <button class="capsule-btn" onclick="addDesign('æ¼¸å±¤', 80)">ğŸŒˆ æ¼¸å±¤</button>
                <button class="capsule-btn" onclick="addDesign('è²“çœ¼', 100)">ğŸ± è²“çœ¼</button>
            </div>
            <div id="designList">
                </div>
        </div>

        <div class="card">
            <div class="card-title">å¸ç”²æœå‹™</div>
            <div class="segmented-control">
                <div class="segment active" onclick="setRemoval(this, 0)">ç„¡</div>
                <div class="segment" onclick="setRemoval(this, 200)">æœ¬åº— (200)</div>
                <div class="segment" onclick="setRemoval(this, 300)">ä»–åº— (300)</div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                <span style="font-size: 0.9rem;">ç«‹é«”é£¾å“å¸é™¤ (+$50/æŒ‡)</span>
                <div class="stepper" style="width: 100px;">
                    <button onclick="changeStepper('removal3D', -1)">-</button>
                    <span id="removal3D">0</span>
                    <button onclick="changeStepper('removal3D', 1)">+</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">æŠ˜æ‰£æˆ–é¡å¤–åŠ åƒ¹</div>
            <input type="number" id="extraAdjust" placeholder="æ­£æ•¸åŠ åƒ¹ï¼Œè² æ•¸æŠ˜æ‰£ (ä¾‹å¦‚ -100)" onchange="calcTotal()" onclick="autoFocus(this)">
        </div>
    </div>

    <div class="sticky-footer">
        <div>
            <div class="total-label">é ç®—ç¸½è¨ˆ</div>
            <div class="total-amount">NT$ <span id="displayTotal">1,000</span></div>
        </div>
        <div class="footer-btns">
            <button class="btn-main" onclick="toggleModal(true)">ğŸ‘ï¸ æ˜ç´°</button>
        </div>
    </div>

    <div class="modal-overlay" id="overlay" onclick="toggleModal(false)"></div>
    <div class="bottom-sheet" id="bottomSheet">
        <div style="width: 40px; height: 5px; background: #eee; border-radius: 5px; margin: -10px auto 20px;"></div>
        <h3 style="margin-top: 0;">é›»å­å¸³å–®æ˜ç´°</h3>
        <div id="billContent">
            </div>
        <button class="copy-btn" onclick="copyBill()">ğŸ“‹ è¤‡è£½å¸³å–®è³‡è¨Š</button>
    </div>

    <script>
        let designs = [];
        let removalPrice = 0;
        let removal3DCount = 0;

        // 1. è‡ªå‹•å…¨é¸èˆ‡æ²å‹•å„ªåŒ–
        function autoFocus(el) {
            el.select();
            setTimeout(() => {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        // 2. æ–°å¢é€ å‹
        function addDesign(name, price) {
            const id = Date.now();
            designs.push({ id, name, price, qty: 1 });
            renderDesigns();
            calcTotal();
        }

        function renderDesigns() {
            const container = document.getElementById('designList');
            container.innerHTML = '';
            designs.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <input type="text" value="${item.name}" onchange="updateDesign(${index}, 'name', this.value)">
                    <input type="number" value="${item.price}" onchange="updateDesign(${index}, 'price', this.value)" onclick="autoFocus(this)">
                    <div class="stepper">
                        <button onclick="updateQty(${index}, -1)">-</button>
                        <span>${item.qty}</span>
                        <button onclick="updateQty(${index}, 1)">+</button>
                    </div>
                    <button class="btn-delete" onclick="removeDesign(${index})">Ã—</button>
                `;
                container.appendChild(div);
            });
        }

        function updateDesign(index, field, value) {
            designs[index][field] = field === 'price' ? parseInt(value) || 0 : value;
            calcTotal();
        }

        function updateQty(index, change) {
            designs[index].qty = Math.max(1, designs[index].qty + change);
            renderDesigns();
            calcTotal();
        }

        function removeDesign(index) {
            designs.splice(index, 1);
            renderDesigns();
            calcTotal();
        }

        // 3. å¸ç”²è™•ç†
        function setRemoval(el, price) {
            document.querySelectorAll('.segment').forEach(s => s.classList.remove('active'));
            el.classList.add('active');
            removalPrice = price;
            calcTotal();
        }

        function changeStepper(id, change) {
            removal3DCount = Math.max(0, removal3DCount + change);
            document.getElementById(id).innerText = removal3DCount;
            calcTotal();
        }

        // 4. è¨ˆç®—ç¸½åƒ¹
        function calcTotal() {
            const base = parseInt(document.getElementById('basePrice').value) || 0;
            const extra = parseInt(document.getElementById('extraAdjust').value) || 0;
            const designsTotal = designs.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const removal3DTotal = removal3DCount * 50;
            
            const total = base + designsTotal + removalPrice + removal3DTotal + extra;
            document.getElementById('displayTotal').innerText = total.toLocaleString();
            return { base, designsTotal, removalPrice, removal3DTotal, extra, total };
        }

        // 5. Modal æ§åˆ¶
        function toggleModal(show) {
            const overlay = document.getElementById('overlay');
            const sheet = document.getElementById('bottomSheet');
            if (show) {
                updateBillDetail();
                overlay.style.display = 'block';
                setTimeout(() => sheet.classList.add('active'), 10);
            } else {
                sheet.classList.remove('active');
                setTimeout(() => overlay.style.display = 'none', 300);
            }
        }

        function updateBillDetail() {
            const data = calcTotal();
            let html = `
                <div class="bill-item"><span>åŸºç¤åº•åƒ¹</span><span>$${data.base}</span></div>
            `;
            
            designs.forEach(item => {
                html += `<div class="bill-item"><span>${item.name} (x${item.qty})</span><span>$${item.price * item.qty}</span></div>`;
            });

            if (data.removalPrice > 0) {
                html += `<div class="bill-item"><span>å¸ç”²æœå‹™</span><span>$${data.removalPrice}</span></div>`;
            }
            if (data.removal3DTotal > 0) {
                html += `<div class="bill-item"><span>ç«‹é«”å¸é™¤ (${removal3DCount}æŒ‡)</span><span>$${data.removal3DTotal}</span></div>`;
            }
            if (data.extra !== 0) {
                html += `<div class="bill-item"><span>å…¶ä»–èª¿æ•´</span><span>$${data.extra}</span></div>`;
            }

            html += `<div class="bill-total">ç¸½è¨ˆï¼šNT$ ${data.total.toLocaleString()}</div>`;
            document.getElementById('billContent').innerHTML = html;
        }

        // 6. è¤‡è£½åŠŸèƒ½
        function copyBill() {
            const data = calcTotal();
            let text = `âœ¨ Nail Art æœå‹™æ˜ç´° âœ¨\n`;
            text += `--------------------------\n`;
            text += `åŸºç¤åº•åƒ¹: $${data.base}\n`;
            designs.forEach(item => {
                text += `${item.name} x${item.qty}: $${item.price * item.qty}\n`;
            });
            if (data.removalPrice > 0) text += `å¸ç”²æœå‹™: $${data.removalPrice}\n`;
            if (data.removal3DTotal > 0) text += `ç«‹é«”å¸é™¤ x${removal3DCount}: $${data.removal3DTotal}\n`;
            if (data.extra !== 0) text += `å…¶ä»–èª¿æ•´: $${data.extra}\n`;
            text += `--------------------------\n`;
            text += `ç¸½è¨ˆé‡‘é¡: NT$ ${data.total.toLocaleString()}\n`;
            text += `è¬è¬æ‚¨çš„é ç´„ï¼ŒæœŸå¾…ç‚ºæ‚¨æœå‹™ï¼`;

            navigator.clipboard.writeText(text).then(() => {
                alert('å¸³å–®æ˜ç´°å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            });
        }
    </script>
</body>
</html>